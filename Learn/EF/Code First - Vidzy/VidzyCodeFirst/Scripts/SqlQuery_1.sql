DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'VidzyCodeFirst.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201909090438384_CreateBaseTables'
BEGIN
    CREATE TABLE [dbo].[Genres] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[Videos] (
        [Id] [int] NOT NULL IDENTITY,
        [Name] [nvarchar](max),
        [ReleaseDate] [datetime] NOT NULL,
        CONSTRAINT [PK_dbo.Videos] PRIMARY KEY ([Id])
    )
    CREATE TABLE [dbo].[VideoGenres] (
        [Video_Id] [int] NOT NULL,
        [Genre_Id] [int] NOT NULL,
        CONSTRAINT [PK_dbo.VideoGenres] PRIMARY KEY ([Video_Id], [Genre_Id])
    )
    CREATE INDEX [IX_Video_Id] ON [dbo].[VideoGenres]([Video_Id])
    CREATE INDEX [IX_Genre_Id] ON [dbo].[VideoGenres]([Genre_Id])
    ALTER TABLE [dbo].[VideoGenres] ADD CONSTRAINT [FK_dbo.VideoGenres_dbo.Videos_Video_Id] FOREIGN KEY ([Video_Id]) REFERENCES [dbo].[Videos] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[VideoGenres] ADD CONSTRAINT [FK_dbo.VideoGenres_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201909090438384_CreateBaseTables', N'VidzyCodeFirst.Migrations.Configuration',  0x1F8B0800000000000400ED59CD6EE33610BE17E83B083AB545D64AB297AD61EF22759222E8260EE224E82DA0A5B14394A254920AEC2DFA643DF491FA0A1DEA5FA464C9EE222DDA2240208BF33F1F8733D41FBFFD3EF9B00999F30242D2884FDD93D1B1EB00F7A380F2F5D44DD4EACD3BF7C3FB2FBF985C04E1C6792CE8DE6A3AE4E472EA3E2B158F3D4FFACF1012390AA92F2219ADD4C88F428F0491777A7CFCAD7772E2018A705196E34CEE12AE6808E90FFC398BB80FB14A08BB8E0260327F8F2B8B54AA7343429031F161EA3ED2E0D376866497544835CA185CE78C5182C62C80AD5C87701E29A2D0D4F183848512115F2F627C41D8FD3606A45B11262177615C910FF5E6F8547BE3558C85283F912A0AF71478F2360F8F67B21F1464B70C1F06F00203ADB6DAEB348853F77BE0023D37358D674C68AA8E008F52B623A7B97854220281A3FF8E9C59C2542260CA215182B023E7365932EAFF00DBFBE827E0539E305637104DC4B5C60B7C752BA21884DADEC12A37FB2A701DAFC9E7998C255B8D27F3E98AABB7A7AE7383CAC9924199FF9AFF0B1509402F411005C12D510A04D732208DA0A5DDD0A5FF17DA1070B87D5CE79A6C3E025FABE7A98B8FAE73493710146F720B1E38C5DD864C4A246029B9212F749DDA67A8C33C4084B0BF03962ECB671A67E81FA54B4F69BE90E05244E15DC40A96FCFDD33D116B506870D4B2B88812E11BC64CBC0A493BF1954ADA1F5F29DBFFF87A657C194A104D40249CA385852EFD7C4FB56ECBB9A1582DA07828560B38B662B500F210AC9E4919F934B5A10ED6427FD39D0B1E38BB8CC932513A81D94064D218B1889AA7EE37567C3A04963BB1129897E89D02275ECD1B7B43E289AA0845B0558E7E4A5FC246B56C4E3C25F3FD2973A498B66BA10B50464AAB38374DB75C6FB217D5CB62CF4369B0D73C356494D0A991B441CBDCFF3DC92DEDAD4CF5068A28D2591351D8689697A65B2DF82D9358F5435ED610158D93D7D1394DAE491C638DA87552F91B6791B551B3378BFD9B8B3093E1F9B2A5C728AD2D3561C5236B3056517551DEB1B69025D1A5641684165903B21D782A5435506967AA405941AE9F1BFBA2ADD931E55431BC44B7422CDBA9876066DAE64BFB58C28868393F66114B42DE7506EDE2CE4E843A7FF6C69630F10CC3CD087956880CA89A011F948E7CEBFCF574645561FF7474F0FDDDE9E892D0387DEB821A0BAF9FDE669D6AC97159850725B2A46E4D57EB16D2C5B6AD0136EAB61D994179CE44B5655B47A654BCA74DF94170A04DA9903D6D324F143B99D6C1629294502A0F18E32099E445BD7F4EB7AA7C46E23A68FB0B060A2BFC622B1584234D305AFCCC668C22782B826BC2E90AA4CA1A7B17E7E45363CEFFE7CCDC9E94011B3278BFFA684275487B878FBEE67EC734C25F88F09F89F82A249BAFEB92EC8963CF21F23F1DAB41D35980CFAA7F3ADB2FEE0703754721B589BB2A5C7FBE2A35B5AC5923CD150F6033757F4999C6CED58F4F05DF913317585EC6CEB1F3EBDED9ACCCDE4F79C1B787F2C3C6D8D6C3D09C56FAE7D713EB0C9EF37304A002E7CCCFAAEC8C489F0476C4F401B5537B3E249A260C197BF5DD31AC40E8BD48189E6352093CC9AC96E75650EED398B086D7F6613CA48268974A79E6CA39C4C07569B01D1CA26D57EF518A36C2DB1780CEAB811EE0B4752CB5D4D9596B4DD8BF0C38C353F9BAC0D9D5207E76E0B4DF29D973FC804BA3EE3BA3AC3FC4336DA9CB5356153BAE4E5AEF93BAAF93DA24B7DFEBB44BEE32BCBED8A9A3C385DE3BADF2326AF7D556C7EC63177C6B2EEEBDD26AB86D4E68C36FB306395B5C9BF538DB3E54D945CABA93792D67F7B8BAB32729DCA1B5EFA25821245D5722F457520E7E636F9634577C151545C2B0A820311A996B5004DB477226145D115FE1B20F52A61F161E094B90E4225C4270C5E7898A13852E43B8648D0F15BAD4ECD29FDE4F366D9ECCE3F41BC0E77001CDA4BA039EF3EF12CA82D2EECB965EAA4384AE6179AFAF73A974CFBFDE96926E223E50501EBEB2F4DE4318331426E77C415EE010DB1E247C8435F1B7C540DC2DA43F11CDB04FCE29590B12CA5C46C58F3F11C341B879FF2765C9F95D1E200000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201909090446460_ChangeVideoGenreRelationship'
BEGIN
    IF object_id(N'[dbo].[FK_dbo.VideoGenres_dbo.Videos_Video_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[VideoGenres] DROP CONSTRAINT [FK_dbo.VideoGenres_dbo.Videos_Video_Id]
    IF object_id(N'[dbo].[FK_dbo.VideoGenres_dbo.Genres_Genre_Id]', N'F') IS NOT NULL
        ALTER TABLE [dbo].[VideoGenres] DROP CONSTRAINT [FK_dbo.VideoGenres_dbo.Genres_Genre_Id]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Video_Id' AND object_id = object_id(N'[dbo].[VideoGenres]', N'U'))
        DROP INDEX [IX_Video_Id] ON [dbo].[VideoGenres]
    IF EXISTS (SELECT name FROM sys.indexes WHERE name = N'IX_Genre_Id' AND object_id = object_id(N'[dbo].[VideoGenres]', N'U'))
        DROP INDEX [IX_Genre_Id] ON [dbo].[VideoGenres]
    ALTER TABLE [dbo].[Videos] ADD [Genre_Id] [int]
    CREATE INDEX [IX_Genre_Id] ON [dbo].[Videos]([Genre_Id])
    ALTER TABLE [dbo].[Videos] ADD CONSTRAINT [FK_dbo.Videos_dbo.Genres_Genre_Id] FOREIGN KEY ([Genre_Id]) REFERENCES [dbo].[Genres] ([Id])
    DROP TABLE [dbo].[VideoGenres]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201909090446460_ChangeVideoGenreRelationship', N'VidzyCodeFirst.Migrations.Configuration',  0x1F8B0800000000000400ED59DB6EE336107D2FD07F10F4D416592BC9BEB486BD8BD4490AA39B0BA224E85B404B63872845AA2415D85BF4CBFAD04FEA2F74A89B2552B6656F372DD02240E0909C3357CEF0387FFEFEC7E8FD3261DE0B4845051FFB278363DF031E8998F2C5D8CFF4FCCDB7FEFB775F7E31BA8893A5F7589D7B6BCEA1245763FF59EB7418042A7A8684A8414223299498EB41249280C422383D3EFE2E38390900217CC4F2BCD15DC6354D20FF03FF9C081E41AA33C2AE440C4C95EBB813E6A8DE354940A52482B1FF48E38FAB091EBBA452E94121E07B678C1234260436F73DC2B9D044A3A9C30705A196822FC2141708BB5FA580E7E68429285D18AE8FF7F5E6F8D47813AC052BA828535A247B029EBC2DC313D8E20705D9AFC38701BCC040EB95F13A0FE2D8FF01B844CF6D4DC30993E6D486000F72B123AFBD79545704168EF939F22619D3998431874C4BC28EBCDB6CC668F423ACEEC5CFC0C73C63AC69209A887BAD055CBA952205A95777302FCD9EC6BE17B4E5025BB0166BC8143E4DB97E7BEA7BD7A89CCC18D4F96FF81F6A2101BD044934C4B7446B90DC60401E4147BBA5CBFCAEB461C1E1F5F1BD2BB2FC007CA19FC73E7EF4BD4BBA84B85A292D78E0146F1B0A6999415BC92858276F6B4A312920F64F692EF67F4A5F33A5AE923B6040149CA385952EF3F99E1ADD8E7316D63579A18BDC570BB5BCE4089EEFAA679A16BDB148FA53B97F29457227585542C5F253283219196B84BB774FE40274BF3A3D534A443437A059A8A5F2B627173CF6B65852E4A0B61FF380354953AC42D43BF6BF7122D38D5759DFC02B23D1C63B1E0C4E6C1F1BDEB89711079826140B6DEDE8C77C1196BAE362E2502AEFA62AABC4B6DE8086A09BE9C421B78E73DB7AC7F9B6781E822EF132989678C3530BA3AA9BC6898EB2B26FFEF6DCD6C6AEED0CFA2154D96C205481B2DB4ADBA58EDAAD13B87E7A04C5DBA37AA3041B1E29A32B92A6D81B1A8F9672C50B8B17CBE44DB8FF1C4F0A8C20521DE3BCB6B6D6849D8E2CC0DA45D5555BC79E4266C4B490499C38C75AE5BAA1962A55AD8A741355555875DC7C6EDD89AE77858DB38EE125BA9560BBCE3D043BD3AE5CFE64248CC88EB931112C4BF8A6D9B34DBA98044DF962C545180596E1768402274456A9DA01EF958EF2E67C7A3A8A8EB07F3A36C8FDD3E9D884D09ABA4DA0D6C6EBA7B7DDA73A725C75E05E79AC0EF74A9669B256943A9AAD1B915EF92D30BAB26C2252EBDDCFA472821C68D2DEC6607F8C69FE98992AF330AB1F657D1CB547909B7D6712D947EADAAB2792357946E514D8CDA19DB1501CF13DF4FD05238C23215C290DC9C01C1884BFB009A358EDEB035784D339285D30001F39ECA9C5C1FF3D7C38502A667D48F1AB73186A42BA93A5EC62015B680B7F21327A26F2AB842CBF6E227D32DBFC4FC7AA178D8BF1B3EE45E3BAC8DB93E5B9C321A63C86E5D8FF35171A7AD39F9E2AB923EF46E2151D7AC7DE6F87E5FC30E6D6184DFB912BF7857F08E5C3420369EA8030ECA14A4BECA2CE7CBE451A1FD194B096CDEE08E953BD267E359EBD730E297053962DB7FA28DA362B6B54EB1AEDF27D4FFAEAD2861EFC74333D2DA60BDE8899496C518C1B985A2775DDCC5CBB90BB59E46764B52DEF1BE464278F75C9EFE761AEEEBB002BA6F10D3C16ABA28B358479EA70885AB5529F99F2B9A88AD6B2A83A62F5B32BD0049B2139939ACE49A4713B02A5F2EFD31E09CBF0C845328378CA6F329D661A5D8664C65ADFCF99D2DFA63FA7E76D9B473769FEDDD7DFE1029A494D3FBFE1DF6794C5B5DD976E3FDF0461EE5439B94C2EB599608B558D742D784FA0327C752BB887246508A66E78485EE010DB1E147C80058956D5F36E33C8EE44B4C33E3AA7642149A24A8CB5BCF9AF5260FEADF4EE2F76A23991881A0000 , N'6.2.0-61023')
END

IF @CurrentMigration < '201909090452535_AddClassification'
BEGIN
    ALTER TABLE [dbo].[Videos] ADD [Classification] [tinyint] NOT NULL DEFAULT 0
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201909090452535_AddClassification', N'VidzyCodeFirst.Migrations.Configuration',  0x1F8B0800000000000400ED595B6FDB36147E1FB0FF20E8691B52CB4E5EB6C06ED1BA4961AC4E82282DF656D0D2B1438CA234920AEC0DFB657BD84FDA5FD8A144DD48D991D3CB066C285058E43987E7F2F15C98BFFEF873FA629B30EF0184A4299FF993D1D8F78047694CF966E6E76AFDEC7BFFC5F3AFBF9A5EC4C9D67B5FD19D693AE4E472E6DF2B959D07818CEE21217294D048A4325DAB5194260189D3E0743CFE21984C0240113ECAF2BCE96DCE154DA0F8C0CF79CA23C8544ED8328D8149B38E3B6121D5BB2209C88C4430F3DFD3F8D7DD1CC92EA9906A5432F8DE4B46092A13025BFB1EE13C5544A1AAE7EF24844AA47C1366B840D8DD2E03A45B1326C19870DE900FB5667CAAAD091AC64A54944B9526470A9C9C19F70436FB939CECD7EE43075EA0A3D54E5B5D3871E6BF012ED072FBA4F339139A6A8F834705DB89D7DD3CA91181C0D1FF4EBC79CE542E60C6215782B013EF265F311AFD08BBBBF467E0339E33D6561055C4BDCE022EDD883403A176B7B0366A2F62DF0BBA7C81CD58B3B5784A9B165C9D9DFADE151E4E560CEAF8B7EC0F552A00AD044114C4374429105CCB80C283CEE9D659FAFFEA34041C5E1FDF5B92ED5BE01B753FF3F1A7EF5DD22DC4D58AD1E01DA778DB9049891CBA874C83267807438A4181F4F890166CFF87F44B86D43DE416181009AF51C3EA2CFDFB8EEAB31DE30ECB9A3322255DD3C8E40EA33AA6C491BDF598E42BF2403705AD7586491FA876B12BEF69668E28E0F4C1EC5F8A34B94D5905CE72F94398E622D276A6EEDE1D111B50436F409EB4F06F1BB790978C6C9A2C7FECC5E8CAFB543704711183603BC45179F8AB1DC6BCEBF625242B10C6AC90322CCCBEF79EB01C3F274E903AD46F5216D7B4A787696F74F0D08735FD99EBF7D2C3EDC59752A6112D7CD24E3C26E4DDE32E78EC1D887F034C93BB96E8419AA1CF30DA33FF3B47FD7E7915665AF20CFEBAF2C6A3D1C4B6B0658D9B5CB1215184F2DA6106015CC156F5E0099B0C0329696EBDADBD161A826A5F226C5A1A7477B5778CEFB2172EE86337CEB4D85B965A32AADBDAA2E8B9CC76263F1CDB5AD946CF6098842A9A2D0995A3EC32D135A92763D4016C5AC9A0EC25AB9E33D8D3744E9724CBF08EB69A50B3E28565073A7F161EDF9725A58C20923DED59AD6D7D12562EB2016B178FAE9210D608B2223AB9CDE3C421EBC0750F96AAA33A8874035521AC22D7BF3B77A2AF4FB4E5343EBC44B3122CBF85856047DAE52B4600C288E8E903E629CB13BEAF9738C45D56F6367FB9E24A980696E2B68702C74516546D870F0A87B9391F1F8E32231C1F8E3D7CFF7438F649E874516D419D8DE1F2EC8EA22DD2DEFBF2A0E966BF1EE454797D103A2AE24110D0A9DBF2554F0A773D320835A58C3EEC688FD4E71EA792A94B4F54E9686530EBC6B46891165237D975133AC450BBB0B9D177EA9B4D5263AFAE73563D9B9ADAF2F84B8B536C4A12DF43DB1FD0C35868C29D54908C34C128FC85CD1945B437044BC2E91AA42ABB60FF743C39B55E6AFE3DAF268194311BF274F2C5275DAA5DFAE82C7BE4ACD81E6EF90311D13D11DF2464FB6D5BD247BF49FCA77D3568D88FF1B7FA74C33E8E75BBC207474A6B3252CB8FCE9CB3C009763BF37F2B98CEBDC54F1F2ABE13EF5AE0853FF7C6DEEF4F43D0D3A6CB56A13B6E0074A790A78CA5085B101A558461469638FC53B7DADF08CA239A11D6D1D92D4843EE82F65F2DCFDE790D19700DF28E59430E3A54796BA9D6A57CCCF623476C77B4193043EF1FA1CB5A85F76BA5035B8271CF34D93B5EEF9FAEFB24F74FBA9F71F2EE58DF1AA01E9DB5DD01FDF34CD76E97818869FDD507C12AE9A611A11B270E51072B35CD82AFD30AB49646158995CF96A008A656F25228BA2691C2ED08305FEA375CF3E67591AC205EF0EB5C65B942932159B1CE9BB086FEA1F38B2784AECED3EBAC7815FD1426A09A5457876BFE2AA7ADB7BD4B379FEF13A1EF94A9833A964AD7C3CDAE967495F281828CFBEA54700749C65098BCE6217980A7E8F64EC25BD8906857358BFB853C1E88AEDBA7AF29D908924823A3E1C74FC4709C6C9FFF0DA6BB524FFC1C0000 , N'6.2.0-61023')
END

